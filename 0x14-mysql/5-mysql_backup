#!/usr/bin/env bash

# Check if the password argument is provided
if [ -z "$1" ]; then
  echo "Please provide the MySQL root password as an argument."
  exit 1
fi

# MySQL root password
password="$1"

# Create a temporary directory
temp_dir=$(mktemp -d)

# Perform the MySQL dump
mysqldump --all-databases -u root --password="$password" > "$temp_dir/backup.sql"

# Check if the dump was successful
if [ $? -eq 0 ]; then
  # Current date
  current_date=$(date +"%d-%m-%Y")

  # Compress the dump to a tar.gz archive
  archive_file="$current_date.tar.gz"
  tar -czvf "$archive_file" -C "$temp_dir" backup.sql

  if [ $? -eq 0 ]; then
    echo "MySQL dump and compression completed successfully."
    echo "Backup archive saved as $archive_file"
  else
    echo "Error: Failed to compress the MySQL dump."
  fi
else
  echo "Error: Failed to create the MySQL dump."
fi

# Clean up the temporary directory
rm -r "$temp_dir"
